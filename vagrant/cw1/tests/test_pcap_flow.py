import pytest
from pcap_flow import Flow
from ipaddress import ip_network

testfile1 = '202011251400-78-5k.pcap'
testfile2 = '202011251400-78.pcap.gz'
testdata_flow = {
(2748507938, 223426464, 51344, 443): 1124, (3288601776, 2244912032, 64754, 30005): 24, (3105698669, 2748473829, 42171, 23): 20, (2124139347, 2748479527, 32776, 60687): 2391, (1758428501, 2748508573, 41069, 57219): 20, (3104823534, 3397983852, 53223, 518): 20, (1543439147, 2748450042, 58020, 3384): 20, (767369071, 2244905534, 52492, 5168): 20, (2808653695, 2748469036, 48111, 5683): 24, (2244894628, 745902372, 60081, 443): 5709, (3288601795, 2748474950, 49742, 8999): 24, (2404151821, 2748480320, 443, 59790): 103, (3273088939, 2244876789, 46858, 1143): 20, (3178500509, 2235271327, 45332, 445): 32, (1747044625, 2748480172, 443, 57714): 65, (765683309, 2748481317, 53229, 6626): 20, (2748497619, 225701324, 65256, 443): 5374, (3273088939, 2244889376, 46858, 1143): 20, (314002142, 2748497859, 443, 65071): 76, (765683415, 2748488258, 44534, 5028): 20
}

def test_pcap_flow1():
    data = Flow(testfile1)
    r = []
    for k in data.ft.keys():
        r.append((k[1], k[0], k[3], k[2]))
    for k in data.ft.keys():
        for j in r:
            assert j != k
    assert len(data.ft) == 656

def test_pcap_flow2():
    data = Flow(testfile2)
    for k, v in testdata_flow.items():
        assert data.ft[k] == v
